<div ng-controller="BrewController as brewController">

	<ng-include src="tpl/header.jsp"></ng-include>


	<div class="container-fluid">

		<div class="row-fluid">
			<ng-include src="tpl/sidebar.jsp"></ng-include>
			<!--/span-->
			<div class="span9" id="content">

				<!--/span-->
				<div id="submissionFailed" class="alert alert-error"
					ng-show="brewController.showErrors">
					<button class="close" data-dismiss="alert">&times;</button>
					<strong>Error!</strong> {{ brewController.submissionFailureMessage
					}}
				</div>
				<div id="submissionSuccess" class="alert alert-success"
					ng-show="brewController.showSuccess">
					<button class="close" data-dismiss="alert">&times;</button>
					<strong>Success!</strong> {{
					brewController.submissionSuccessMessage }}
				</div>
				<div class="block">
					<div class="navbar navbar-inner block-header">
						<div class="muted pull-left"
							style="font-weight: bold; text-align: center;">{{brewController.brew.name}}</div>
					</div>
				</div>

				<div class="block">
					<div class="navbar navbar-inner block-header">
						<div class="muted pull-left" style="font-size: 10px;">
							Display range (minutes) : <input type="text" id="delay"
								name="delay" value="{{brewController.defaultDelayValue}}" />
							Points displayed : <input type="text" id="maxPts" name="maxPts"
								value="${defaultmaxPtsValue}" />
						</div>
					</div>
				</div>
				<!-- Loop over each step -->
				<div ng-if="currentFullBrew.steps.length > 0">
					<div class="row-fluid"
						ng-repeat="step in brewController.currentFullBrew.steps">
						<div class="span6">
							<!-- block -->
							<div class="block">
								<div class="navbar navbar-inner block-header">
									<div class="muted pull-left">Etape</div>
									<div class="pull-right">
										<span class="badge badge-info">
											<button id="start{{step.id}}"
												onClick="startStep({{ step.id });">Demarrer</button>
										</span> <span class="badge badge-info"><button
												id="stop{{step.id}}" onClick="stopStep({{step.id}});"
												disabled>Arreter</button></span>

									</div>
								</div>
								<div class="block-content collapse in">
									<table class="table table-striped" style="table-layout: fixed;">
										<thead>
											<tr>
												<th>#</th>
												<th>Label</th>
												<th>Duree</th>
												<th>Temperature</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>step.number</td>
												<td>step.name</td>
												<td>step.duration</td>
												<td>step.theoreticalTemperature</td>
											</tr>

											<tr>
												<td colspan="4"><span
													ng-repeat="actioner in step.actioners"> <a href="#"
														onclick="brewController.changeActionerState(actioner.id, step.id, actioner.$index)">

															<img class="actioner.class" id="IMGACT{{actioner.uuid}}"
															style="height: 50px; width: 50px;"
															src="{{actioner.picture}}" />
													</a>

												</span></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<!-- /block -->
						</div>
						<div class="span6">
							<!-- block -->
							<div class="block">
								<div class="navbar navbar-inner block-header">
									<div class="muted pull-left">Etape</div>
									<div class="pull-right">
										<span class="badge badge-info">{{step.number}}</span>

									</div>
								</div>
								<div class="block-content collapse in" id="CHART${loop}"'>
									<canvas id="CANVAS$index" class="chart chart-line"
										chart-data="step.chart.data" chart-labels="step.chart.labels" chart-series="step.chart.series"
										chart-options="step.chart.options"
										chart-dataset-override="step.chart.datasetOverride" width="450px"
										height="300px"'>
                                </canvas>

								</div>
							</div>
						</div>
					</div>
				</div>
				</c:if>

				</c:forEach>
				</c:if>
				<div class="row-fluid">

					<!-- block -->
					<div class="block">
						<div class="navbar navbar-inner block-header">
							<div class="muted pull-left">Ajouter une etape</div>
							<div class="pull-right">
								<span class="badge badge-info">{{brewController.currentFullBrew.steps.length}}</span>

							</div>
						</div>
						<div class="block-content collapse in">
							<form name="addAStepForm"
								ng-submit="brewController.addAStep(addAStepForm)"
								class="form-horizontal">
								<table class="table table-striped">
									<tbody>
										<tr>
											<td>Label</td>
											<td><input type="text" name="step_label"
												ng-model="step.label" /><</td>

											<td>Duree theorique</td>
											<td><input type="text" name="step_duration"
												ng-model="step.duration" /></td>
										</tr>
										<tr>
											<td>Debut</td>
											<td id="stepBeginningAdd"><md-datepicker
													ng-model="step.beginning"></md-datepicker></td>

											<td>Fin</td>
											<td id="stepEndAdd"><md-datepicker ng-model="step.end"></md-datepicker></td>
										</tr>
										<tr>
											<td>Temperature theorique</td>
											<td><input type="text" name="step_temperature"
												ng-model="step.temperature" /></td>

											<td>Commentaire</td>
											<td><textarea name="step_comment"
													ng-model="step.comment" rows="3" cols="15"></textarea></td>
										</tr>
										<tr>
											<td>Etape nÂ°</td>
											<td><input type="text" name="step_number"
												value="{{ brewController.currentFullBrew.steps.length }}" />
											</td>
											<td></td>
											<td></td>
											<td>
										</tr>
										<tr>
											<td></td>
											<td></td>
											<td></td>
											<td><button type="submit" class="btn btn-primary">+</button></td>
										</tr>
									</tbody>
								</table>
							</form>
						</div>
						<!-- /block -->
					</div>
				</div>
				<div class="row-fluid">
					<!-- block -->
					<div class="block">

						<div class="navbar navbar-inner block-header">
							<div class="muted pull-left">Profil complet de temperature</div>

						</div>


					</div>
				</div>
				<div class="row-fluid">
					<!-- block -->
					<div class="block">

						<div class="navbar navbar-inner block-header">
							<div class="muted pull-left">Biere</div>
						</div>
						<div class="block-content collapse in">
							<table class="table table-striped">

								<tr>
									<td style="width: 20%;">Nom :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_name()}</td>
									<td style="width: 20%;">Style :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_style()}</td>
								</tr>
								<tr>
									<td style="width: 20%;">Taux d'alcool :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_alcohol()}</td>
									<td style="width: 20%;">Densite :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_density()}</td>
								</tr>
								<tr>
									<td style="width: 20%;">Couleur (EBC) :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_color_ebc()}</td>
									<td style="width: 20%;">Aromes :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_aroma()}</td>
								</tr>
								<tr>
									<td style="width: 20%;">Note / 10 :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_notation()}</td>
									<td style="width: 20%;">Bulles :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_bubbles()}</td>
								</tr>
								<tr>
									<td style="width: 20%;">Commentaire :</td>
									<td style="width: 80%;" colspan="3">${brassin.getBra_beer().getBeer_comment()}</td>
								</tr>

								<tr>
									<td style="width: 20%;">Embouteillees :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_init_bottles()}</td>
									<td style="width: 20%;">Restantes :</td>
									<td style="width: 30%;">${brassin.getBra_beer().getBeer_remaining_bottles()}</td>
								</tr>

								<tr>
									<td style="width: 20%;">Progression :</td>
									<td style="width: 30%;"><c:choose>
											<c:when
												test="${brassin.getBra_beer().getBeer_conso_progress() < 33}">

												<div
													class="progress progress-striped progress-success active">
													<div
														style="width: ${brassin.getBra_beer() .getBeer_conso_progress()"
														class="bar"></div>
												</div>

											</c:when>
											<c:when
												test="${brassin.getBra_beer().getBeer_conso_progress() >= 33 && brassin.getBra_beer().getBeer_conso_progress() < 66}">
												<div
													class="progress progress-striped progress-warning active">
													<div
														style="width: ${brassin.getBra_beer() .getBeer_conso_progress()"
														class="bar"></div>
												</div>
											</c:when>
											<c:when
												test="${brassin.getBra_beer().getBeer_conso_progress() >= 66}">
												<div
													class="progress progress-striped progress-danger active">
													<div
														style="width: ${brassin.getBra_beer() .getBeer_conso_progress()"
														class="bar"></div>
												</div>
											</c:when>


										</c:choose></td>
									<td style="width: 20%;">Premiere goulee :</td>
									<td style="width: 30%;"><fmt:formatDate
											value="${brassin.getBra_beer().getBeer_first_drink_date()}"
											pattern="dd/MM/yyyy a HH:mm:ss" /></td>
								</tr>

							</table>

						</div>

					</div>
				</div>

			</div>
		</div>
	</div>
	<ng-include src="tpl/footer.jsp"></ng-include>
</div>